<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Forensic Investigator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1c1c21; /* Deep Space Blue Background */
            color: #e0e0e0; /* Light Gray Text */
        }
        h1, h2, h3 {
            font-family: 'Space Mono', monospace;
        }
        /* Custom Drop Zone Styling */
        .drop-zone {
            border: 3px dashed #4e4e66;
            transition: all 0.2s;
            background-color: #272740;
        }
        .drop-zone.dragover {
            border-color: #00bcd4; /* Cyan highlight */
            background-color: #27273a;
        }
        /* Card Styles */
        .investigator-card {
            background-color: #2a2a47; /* Slightly lighter card background */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid #4e4e66;
        }
        /* Verdict Colors */
        .verdict-ai { color: #ff5555; } /* Red */
        .verdict-human { color: #00ff7f; } /* Bright Green */
        .verdict-inconclusive { color: #ffb86c; } /* Orange */
        /* Progress Bar */
        .progress-bar-bg { background-color: #4e4e66; }
        .progress-bar-fill-ai { background-color: #ff5555; }
        .progress-bar-fill-human { background-color: #00ff7f; }
        .progress-bar-fill-mid { background-color: #ffb86c; }
        /* Explanation Styling */
        #detailed-explanation p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
            font-family: 'Inter', sans-serif;
        }
        #detailed-explanation strong {
            color: #00ff7f; /* Highlight important points in the explanation */
        }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-10 flex flex-col items-center">
    <div class="max-w-6xl w-full mx-auto">
        <header class="text-center mb-12 border-b border-gray-600 pb-4">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-[#00bcd4] tracking-wider mb-2">
                Detecting AI-Generated Documents
            </h1>
            <p class="text-md text-gray-400 font-mono">
                LEVERAGING AI/ML DETECTION IN EDUCATION AND JOB APPLICATIONS 
            </p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-8">
                <div class="investigator-card p-6 rounded-xl space-y-6">
                    <h2 class="text-xl font-bold text-white border-b border-gray-600 pb-2">INPUT DATA</h2>
                    
                    <div id="drop-zone" class="drop-zone flex flex-col items-center justify-center p-6 rounded-lg cursor-pointer h-40">
                        <svg class="w-10 h-10 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        <p class="mt-2 text-sm text-gray-300 font-medium text-center">Upload Image</p>
                        <p id="file-name" class="mt-1 text-xs text-gray-500 font-mono"></p>
                        <input type="file" id="file-input" class="hidden" accept="image/jpeg, image/png, image/webp">
                    </div>

                    <div id="preview-container" class="mt-4 hidden border border-gray-600 rounded-lg p-2">
                        <h3 class="text-sm font-bold text-[#00ff7f] mb-1">IMAGE PREVIEW:</h3>
                        <img id="image-preview" class="w-full max-h-48 object-contain rounded-md" src="" alt="Image Preview">
                    </div>

                    <button id="analyze-button" class="mt-6 w-full py-3 px-4 bg-cyan-600 text-gray-900 font-bold rounded-lg hover:bg-cyan-500 transition duration-150 disabled:bg-gray-600 disabled:text-gray-400" disabled>
                        RUN ANALYSIS
                    </button>
                    <p id="error-message" class="text-sm text-red-500 mt-3 text-center hidden font-mono"></p>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-8">
                <div class="investigator-card p-6 rounded-xl min-h-full">
                    <h2 class="text-xl font-bold text-white border-b border-gray-600 pb-2 mb-4">REPORT & ANALYSIS</h2>
                    
                    <div id="loading-spinner" class="text-center py-16 hidden">
                        <svg class="animate-spin h-10 w-10 text-[#00bcd4] mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-4 text-[#00bcd4] font-mono">Loading ....</p>
                    </div>

                    <div id="initial-message" class="text-center py-16 text-gray-500">
                        Upload image to start the analysis.
                    </div>

                    <div id="results-content" class="hidden">
                        
                        <div class="mb-6 pb-4 border-b border-gray-700">
                            <p class="text-sm font-mono text-gray-400">CLASSIFICATION VERDICT:</p>
                            <div id="verdict-display" class="text-4xl font-extrabold mt-1">N/A</div>
                            
                            <div class="mt-3">
                                <p id="score-label" class="text-sm font-mono text-gray-400 mb-1">LIKELIHOOD SCORE:</p>
                                <div class="w-full progress-bar-bg rounded-full h-3">
                                    <div id="score-bar" class="h-3 rounded-full transition-all duration-1000" style="width: 0%;"></div>
                                </div>
                                <p id="score-value" class="text-right text-sm font-mono text-[#00ff7f] mt-1"></p>
                            </div>
                        </div>

                        <div class="mb-6 p-4 rounded-lg border border-gray-700 bg-[#272740]">
                            <h3 class="text-lg font-bold text-white mb-3">SUMMARY:</h3>
                            <ul id="key-findings-list" class="list-disc list-inside space-y-2 text-gray-300 ml-4">
                                </ul>
                        </div>

       
                        <div id="detailed-explanation" class="text-sm text-gray-300 leading-relaxed space-y-3">
                            </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const fileNameDisplay = document.getElementById('file-name');
        const imagePreview = document.getElementById('image-preview');
        const previewContainer = document.getElementById('preview-container');
        const analyzeButton = document.getElementById('analyze-button');
        const errorMessage = document.getElementById('error-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const resultsContent = document.getElementById('results-content');
        const initialMessage = document.getElementById('initial-message');
        
        // Report Elements
        const verdictDisplay = document.getElementById('verdict-display');
        const scoreBar = document.getElementById('score-bar');
        const scoreValue = document.getElementById('score-value');
        const keyFindingsList = document.getElementById('key-findings-list');
        const detailedExplanation = document.getElementById('detailed-explanation');

        let selectedFile = null;

        // --- File Handling ---

        function handleFile(file) {
            if (file && (file.type === 'image/jpeg' || file.type === 'image/png' || file.type === 'image/webp')) {
                selectedFile = file;
                fileNameDisplay.textContent = `File: ${file.name}`;
                analyzeButton.disabled = false;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
                
                errorMessage.classList.add('hidden');
                initialMessage.classList.add('hidden');
                resultsContent.classList.add('hidden');
            } else {
                selectedFile = null;
                fileNameDisplay.textContent = 'Unsupported file type.';
                analyzeButton.disabled = true;
                errorMessage.textContent = 'Please select a JPEG, PNG, or WebP image.';
                errorMessage.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                initialMessage.classList.remove('hidden');
            }
        }

        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

        // Drag and Drop Events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
        });

        dropZone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const file = dt.files[0];
            handleFile(file);
        }, false);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // --- API Call Logic ---

        analyzeButton.addEventListener('click', async () => {
            if (!selectedFile) return;

            // Reset report display
            resultsContent.classList.add('hidden');
            
            // UI State: Loading
            loadingSpinner.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            analyzeButton.disabled = true;
            analyzeButton.textContent = 'ANALYZING...';
            
            const formData = new FormData();
            formData.append('image', selectedFile);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                if (!response.ok || data.error) {
                    throw new Error(data.message || data.error || 'Unknown analysis error.');
                }

                displayReport(data);

            } catch (error) {
                console.error('API Call Error:', error);
                errorMessage.textContent = `Analysis Error: ${error.message}`;
                errorMessage.classList.remove('hidden');
                resultsContent.classList.add('hidden');
                initialMessage.classList.remove('hidden'); 
            } finally {
                // UI State: Finished
                loadingSpinner.classList.add('hidden');
                analyzeButton.disabled = false;
                analyzeButton.textContent = 'RUN FORENSIC ANALYSIS';
            }
        });

        // --- Report Rendering ---

        function displayReport(data) {
            
            // Reset colors and bar
            verdictDisplay.className = 'text-4xl font-extrabold mt-1';
            scoreBar.className = 'h-3 rounded-full transition-all duration-1000';
            
            // 1. Verdict and Score
            verdictDisplay.textContent = data.verdict.toUpperCase();
            const score = parseFloat(data.likelihoodScore);
            const scorePercent = (score * 100).toFixed(1);

            scoreValue.textContent = score ? `${scorePercent}%` : `N/A`;
            scoreBar.style.width = `${scorePercent}%`;

            // Apply color based on verdict/score
            if (score > 0.8 || data.verdict === 'AI Generated') {
                verdictDisplay.classList.add('verdict-ai');
                scoreBar.classList.add('progress-bar-fill-ai');
            } else if (score < 0.3 || data.verdict === 'Likely Human') {
                verdictDisplay.classList.add('verdict-human');
                scoreBar.classList.add('progress-bar-fill-human');
            } else {
                verdictDisplay.classList.add('verdict-inconclusive');
                scoreBar.classList.add('progress-bar-fill-mid');
            }


            // 2. Key Findings
            keyFindingsList.innerHTML = '';
            (data.keyFindings || []).forEach(finding => {
                const li = document.createElement('li');
                // Highlight keywords in findings for better visibility
                let htmlFinding = finding.replace(/Anatomical Distortions|Inconsistent Noise|Lighting & Shadows|Text & Symbols|Compression Anomalies/g, '<strong>$&</strong>');
                li.innerHTML = htmlFinding;
                keyFindingsList.appendChild(li);
            });
            if (keyFindingsList.innerHTML === '') {
                keyFindingsList.innerHTML = '<li>No specific structured artifacts were noted by the VLM.</li>';
            }

            // 3. Detailed Explanation (Simple Markdown conversion: newlines to paragraphs)
            let explanationHtml = data.detailedExplanation
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    // Simple bolding for *keywords*
                    line = line.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    return `<p>${line}</p>`;
                })
                .join('');
            
            detailedExplanation.innerHTML = explanationHtml;
            
            // UI State: Show Results
            resultsContent.classList.remove('hidden');
            initialMessage.classList.add('hidden');
        }

    </script>
</body>
</html>